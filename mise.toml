# ~/.agents エージェント・スキル管理用 mise 設定

[env]
_.path = ['./node_modules/.bin']
MD_EXCLUDES = "--exclude node_modules --exclude tmux/plugins --exclude fisher --exclude 'zsh/.zinit' --exclude plans --exclude 'plugins/cache' --exclude 'plugins/marketplaces' --exclude projects"
MARKDOWN_LINK_CONFIG = ".markdown-link-check.json"

[tools]
node = '24'                          # Node 24 系に固定
fd = 'latest'                        # ファイル検索用
prettier = 'latest'                  # コードフォーマッター
"npm:markdownlint-cli2" = "latest"
"npm:markdown-link-check" = "latest"
"npm:skills" = "latest"

# === ドキュメント管理 ===
[tasks."docs:lint"]
description = "Markdownファイルのlintチェック"
run = "fd -e md --type f --no-follow ${MD_EXCLUDES} -X markdownlint-cli2"

[tasks."docs:fix"]
description = "Markdownファイルの自動修正"
run = "fd -e md --type f --no-follow ${MD_EXCLUDES} -X markdownlint-cli2 --fix"

[tasks."docs:links"]
description = "Markdownリンクチェック"
run = "fd -e md -X markdown-link-check --quiet --config ${MARKDOWN_LINK_CONFIG}"

[tasks."docs:links:verbose"]
description = "Markdownリンクチェック（詳細モード）"
run = "fd -e md -X markdown-link-check --verbose --config ${MARKDOWN_LINK_CONFIG}"

[tasks."docs:format"]
description = "Prettierでフォーマット"
run = "prettier --write --cache --log-level warn \"${MD_GLOB}\""

[tasks."docs:format:check"]
description = "Prettierフォーマットチェック"
run = "prettier --check --cache \"${MD_GLOB}\""

# === エイリアス ===
[tasks.format]
description = "全ての自動修正を実行"
depends = ["docs:fix", "docs:format"]

[tasks.lint]
description = "全体検証（修正はしない）"
depends = ["docs:lint", "docs:format:check", "docs:links"]

# === スキル管理 ===
[tasks."update"]
description = "npx skills update を実行"
run = "skills update"

[tasks."skills:sync"]
description = "スキルを3箇所に同期"
run = "./scripts/sync-skills.sh"

[tasks."skills:check-links"]
description = "skills/ と skills-internal/ の壊れたリンク検査（警告のみ）"
run = "./scripts/check-skill-links.sh"

[tasks."skills:fix:ui-ux-pro-max"]
description = "ui-ux-pro-max の /tmp リンクを実体化"
run = "./scripts/fix-ui-ux-pro-max.sh"

[tasks."skills:status"]
description = "スキルリンク状態を表示"
run = "./scripts/sync-skills.sh status"

[tasks."skills:refresh"]
alias = "ci"
description = "スキル更新 → 同期"
run = "mise run skills:check-links && mise run update && mise run skills:fix:ui-ux-pro-max && mise run skills:sync"
